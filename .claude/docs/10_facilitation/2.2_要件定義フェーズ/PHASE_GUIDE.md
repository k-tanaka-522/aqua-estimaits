# 要件定義フェーズ実行ガイド（PHASE_GUIDE）

## このドキュメントの目的

**Claude（あなた）が要件定義フェーズを実行するための唯一のエントリーポイント**

- ユーザーとの一問一答で要件定義フェーズを進める
- PDCA 2周で機能要件・非機能要件を収集
- 要件定義書を生成して次フェーズへ遷移

**重要**: このファイルを読めば、要件定義フェーズで何をすべきか全てわかります。他のファイルは参照用です。

---

## §1 このフェーズでやること（What）

### 1.1 要件定義フェーズの目的

**企画書を受けて、システムの要件を詳細に定義する**

- **Input**: 企画書（`docs/01_企画書.md` または `docs/01_企画書/`）
- **Output**: 要件定義書（`docs/02_要件定義書.md` または `docs/02_要件定義書/`）
- **成果物の品質**: 受託開発納品レベル（設計者が設計できるレベル）

### 1.2 要件定義フェーズで決定すること

以下の項目を**すべて**決定します（省略禁止）:

#### A. 機能要件
- [ ] ユーザーストーリー（誰が、何を、なぜ）
- [ ] 主要機能の詳細仕様（入力、処理、出力）
- [ ] 画面遷移図（Mermaid）
- [ ] データフロー図（Mermaid）

#### B. 非機能要件
- [ ] 性能要件（レスポンスタイム、スループット）
- [ ] セキュリティ要件（認証、認可、暗号化）
- [ ] 可用性要件（稼働率、ダウンタイム）
- [ ] 拡張性要件（将来的なユーザー数増加への対応）
- [ ] 運用要件（監視、バックアップ、ログ）

#### C. 外部インターフェース要件
- [ ] 外部システム連携（API、データ連携）
- [ ] 外部サービス連携（決済、メール送信等）

#### D. データ要件
- [ ] 主要データモデル（エンティティ、属性）
- [ ] データ保持期間
- [ ] データ移行要件（既存データがある場合）

#### E. 制約条件
- [ ] 技術制約（既存システムとの互換性等）
- [ ] 運用制約（メンテナンス時間等）
- [ ] 法的制約（個人情報保護法、GDPR等）

### 1.3 要件定義フェーズの制約

- **企画書との整合性**: すべての要件は企画書の目的に紐づく
- **SMART原則**: 要件は具体的（Specific）、測定可能（Measurable）、達成可能（Achievable）、関連性（Relevant）、期限（Time-bound）
- **技術的詳細は避ける**: 「どうやって実現するか」は設計フェーズで決定

---

## §2 技術標準参照

### 2.1 要件定義フェーズでの技術標準参照

要件定義フェーズでは、技術標準は**非機能要件の参考**として参照します。

| 技術標準ファイル | 参照タイミング | 必須度 |
|----------------|--------------|--------|
| `.claude/docs/40_standards/49_security.md` | セキュリティ要件定義時 | ⭐⭐⭐ 必須 |

---

## §3 PDCA 1周目（機能要件の収集）

### 3.1 Plan（計画）

**ユーザーとの対話で、機能要件を明確にする**

#### ステップ1: 企画書の読み込み

```bash
# 企画書を読み込む
docs/01_企画書.md または docs/01_企画書/
```

**確認すべき項目:**
- [ ] システム化の目的（何を達成したいのか）
- [ ] 主要機能（企画書に記載された機能）
- [ ] ターゲットユーザー（誰が使うのか）

#### ステップ2: ユーザーストーリーの作成

**ユーザーへの質問例:**

> 「企画書を確認しました。主要機能として『データ集計自動化』が挙げられています。
>
> この機能について、ユーザーストーリーを作成したいです。
>
> **ユーザーストーリー例:**
> 『営業担当者として、日次のデータ集計を自動化したい。なぜなら、手動集計に2時間かかっており、本来の営業活動に時間を使いたいから。』
>
> この内容で合っていますか？または、追加したい内容はありますか？」

#### ステップ3: 機能詳細の深掘り

**ユーザーへの質問例:**

> 「『データ集計自動化』の詳細を決めましょう。
>
> **入力:**
> - データソースは何ですか？（CSV、データベース、API等）
> - どのくらいの頻度でデータが更新されますか？（毎日、毎時間等）
>
> **処理:**
> - どんな集計をしますか？（合計、平均、グループ化等）
> - 集計条件はありますか？（期間指定、フィルター等）
>
> **出力:**
> - 集計結果はどこに出力しますか？（画面、CSV、メール等）
> - どんなフォーマットですか？（表、グラフ等）」

### 3.2 Do（実行）

**ユーザーの回答を受けて、決定事項を記録する**

**記録場所**: `.claude-state/requirements-decisions.json`

```json
{
  "phase": "requirements",
  "decisions": {
    "functionalRequirements": {
      "userStory1": {
        "as": "営業担当者",
        "want": "日次のデータ集計を自動化したい",
        "so": "手動集計に2時間かかっており、本来の営業活動に時間を使いたいから",
        "input": "CSVファイル（営業データ）、毎日9時に自動取得",
        "process": "日次売上の合計・平均・グループ化（営業担当者別）",
        "output": "画面表示（表・グラフ）、CSV出力、メール送信"
      }
    }
  },
  "updatedAt": "2025-10-24T12:00:00Z"
}
```

### 3.3 Check（確認）

**決定事項を振り返る**

**確認すべき項目:**
- [ ] すべての主要機能がユーザーストーリーになっているか
- [ ] 各機能の「入力・処理・出力」が明確か
- [ ] 企画書の目的と整合性があるか

### 3.4 Act（改善）

**不足している項目を追加質問**

**例:**

> 「機能要件がほぼ固まってきました。
>
> 次に、画面遷移図を作成したいです。
> ユーザーがログインしてから、データ集計結果を確認するまでの流れを教えてください。」

---

## §4 PDCA 2周目（非機能要件の収集）

### 4.1 Plan（計画）

**1周目で収集した機能要件を踏まえて、非機能要件を決定する**

**確認すべき項目:**
- [ ] §1.2 の非機能要件項目がすべて揃っているか

### 4.2 Do（実行）

**非機能要件をユーザーに確認**

**例:**

> 「機能要件が決まりました。次に、非機能要件を決めましょう。
>
> **性能要件:**
> - データ集計処理のレスポンスタイムはどのくらいを想定していますか？
>   - 例: 10秒以内、30秒以内等
>
> **セキュリティ要件:**
> - 認証方式はどうしますか？
>   - 例: ID/パスワード、OAuth、SAML等
>
> **可用性要件:**
> - システムの稼働率はどのくらいを想定していますか？
>   - 例: 99.9%、99.99%等」

### 4.3 Check（確認）

**要件定義書生成前の最終チェック**

#### チェックリスト

**A. 機能要件の網羅性**
- [ ] すべての主要機能がユーザーストーリーになっている
- [ ] 各機能の「入力・処理・出力」が明確
- [ ] 画面遷移図・データフロー図がある

**B. 非機能要件の網羅性**
- [ ] 性能要件が具体的（数値あり）
- [ ] セキュリティ要件が明確
- [ ] 可用性要件が具体的（数値あり）

**C. 企画書との整合性**
- [ ] すべての要件が企画書の目的に紐づいている

### 4.4 Act（改善）

**「もっといい提案」を準備**

**ユーザーへの提案例:**

> 「要件定義がほぼ固まりました。ここまでの内容を振り返ると、以下のような改善案があります:
>
> 1. **データ集計のリアルタイム化**: 9時一括処理ではなく、データ更新のたびに集計
>    - メリット: 常に最新のデータを確認できる
>    - デメリット: サーバー負荷増加
>
> 2. **アラート機能の追加**: 売上が目標を下回った場合、自動でアラート送信
>    - メリット: 問題の早期発見
>    - 追加工数: 2週間
>
> これらを採用しますか？または、現在の要件で進めますか？」

---

## §5 要件定義書生成

### 5.1 要件定義書生成の手順

**参照ドキュメント**: `2.2.7_製造物_要件定義書構成.md`

#### ステップ1: テンプレート読み込み

```bash
# 要件定義書テンプレートを読み込む
.claude/docs/10_facilitation/2.2_要件定義フェーズ/2.2.7_製造物_要件定義書構成.md
```

#### ステップ2: ドキュメント構造決定

**単一ファイル vs ディレクトリ構成**

| 条件 | 推奨構成 |
|------|---------|
| システム規模が小さい（ページ数40以下） | `docs/02_要件定義書.md` |
| システム規模が大きい（ページ数41以上） | `docs/02_要件定義書/` |

#### ステップ3: セクションごとに生成

**必須セクション（省略禁止）:**

##### 2章 機能要件

- [ ] 2.1 ユーザーストーリー ⭐⭐ **省略禁止**
- [ ] 2.2 主要機能の詳細仕様
- [ ] 2.3 画面遷移図（Mermaid） ⭐⭐ **省略禁止**
- [ ] 2.4 データフロー図（Mermaid）

##### 3章 非機能要件

- [ ] 3.1 性能要件 ⭐⭐ **省略禁止**
- [ ] 3.2 セキュリティ要件 ⭐⭐ **省略禁止**
- [ ] 3.3 可用性要件 ⭐⭐ **省略禁止**
- [ ] 3.4 拡張性要件
- [ ] 3.5 運用要件

#### ステップ4: 生成後チェック

**必須セクションチェック:**

```bash
# 要件定義書を読み込んで、必須セクションがあるか確認
docs/02_要件定義書.md または docs/02_要件定義書/
```

**確認項目:**
- [ ] すべての機能にユーザーストーリーがある
- [ ] 画面遷移図（Mermaid）がある
- [ ] 非機能要件が具体的（数値あり）

**よくある省略ミス:**
- ❌ ユーザーストーリーがない（機能説明だけ）
- ❌ 画面遷移図がない
- ❌ 非機能要件が抽象的（数値がない）

### 5.2 要件定義書生成の流れ

**ユーザーへの確認:**

> 「要件定義がすべて決まりました。最後に振り返りをさせてください。
>
> **機能要件:**
> - ユーザーストーリー: 3件
> - 主要機能: データ集計自動化、アラート機能、レポート出力
>
> **非機能要件:**
> - 性能: データ集計10秒以内
> - セキュリティ: ID/パスワード認証、HTTPS通信
> - 可用性: 99.9%
>
> この内容で要件定義書を生成しても良いですか？
> または、追加で検討したいことはありますか？」

**ユーザーの承認後:**

> 「了解しました。要件定義書を生成します。
>
> **生成する要件定義書:**
> - `docs/02_要件定義書/` （ディレクトリ構成）
>
> 生成には5-10分かかります。少々お待ちください...」

---

## §6 次フェーズへの遷移判定

### 6.1 要件定義フェーズ完了条件

以下がすべて満たされたら、設計フェーズへ遷移できます:

#### A. 要件定義書の生成完了
- [ ] `docs/02_要件定義書.md` または `docs/02_要件定義書/` が存在する

#### B. 必須セクションの存在
- [ ] すべての機能にユーザーストーリーがある
- [ ] 画面遷移図（Mermaid）がある
- [ ] 非機能要件が具体的（数値あり）

#### C. 企画書との整合性
- [ ] すべての要件が企画書の目的に紐づいている

### 6.2 次フェーズへの遷移

**ユーザーへの確認:**

> 「要件定義書の生成が完了しました。
>
> **生成した要件定義書:**
> - `docs/02_要件定義書/README.md` - 目次
> - `docs/02_要件定義書/01_システム概要.md`
> - `docs/02_要件定義書/02_機能要件.md`
> - `docs/02_要件定義書/03_非機能要件.md`
> - ...
>
> 要件定義書をレビューして、問題なければ設計フェーズに進みます。
> 要件定義書を確認しますか？または、すぐに設計フェーズに進みますか？」

**プロジェクト状態の更新:**

```json
{
  "projectName": "プロジェクト名",
  "currentPhase": "design",
  "status": "ongoing",
  "completedPhases": ["planning", "requirements"],
  "updatedAt": "2025-10-24T12:00:00Z"
}
```

---

## 📚 参考資料

### 要件定義フェーズの詳細プロセス

以下のファイルは、必要に応じて参照してください（必須ではありません）:

| ファイル | 内容 | 参照タイミング |
|---------|------|---------------|
| `2.2.1_企画書レビュー.md` | 企画書のレビュー方法 | 企画書を読み込む時 |
| `2.2.2_ユーザーストーリー作成手順.md` | ユーザーストーリーの作成方法 | 機能要件を決める時 |
| `2.2.3_非機能要件定義手順.md` | 非機能要件の定義方法 | 非機能要件を決める時 |
| `2.2.4_画面遷移図作成手順.md` | 画面遷移図の作成方法 | 画面遷移を決める時 |
| `2.2.7_製造物_要件定義書構成.md` | 要件定義書テンプレート | 要件定義書を生成する時 |

---

## 🚨 重要な注意事項

### 1. SMART原則

**要件は具体的、測定可能、達成可能、関連性、期限**

❌ Bad:
> 「システムを高速にする」

✅ Good:
> 「データ集計処理を10秒以内に完了する（現状2時間 → 目標10秒）」

### 2. 技術的詳細は避ける

**「何をするか」を定義し、「どうやるか」は設計フェーズで決定**

❌ Bad:
> 「データベースはPostgreSQLを使う」

✅ Good:
> 「データを永続化し、ACID保証が必要」

### 3. ユーザーストーリーは必須

**すべての機能にユーザーストーリーを作成**

✅ Good:
```markdown
### ユーザーストーリー1: データ集計自動化

**As a** 営業担当者
**I want** 日次のデータ集計を自動化したい
**So that** 手動集計に2時間かかっており、本来の営業活動に時間を使いたいから

**受け入れ条件:**
- [ ] CSVファイルを自動取得できる
- [ ] 日次売上の合計・平均を集計できる
- [ ] 結果を画面表示・CSV出力・メール送信できる
```

### 4. 画面遷移図・データフロー図は必須

**Mermaidで図を作成**

✅ Good:
```markdown
### 画面遷移図

\`\`\`mermaid
graph LR
    A[ログイン] --> B[ダッシュボード]
    B --> C[データ集計]
    C --> D[レポート出力]
\`\`\`
```

---

**作成日**: 2025-10-24
**対象フェーズ**: 要件定義
**重要度**: ⭐⭐⭐ 最重要
