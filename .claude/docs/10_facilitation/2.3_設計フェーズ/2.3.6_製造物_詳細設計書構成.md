# 2.3.6 製造物 - 詳細設計書構成

## 目的

**詳細設計書のテンプレート・記述方法**を提供します。

---

## 📋 詳細設計書の目次構成

```markdown
# 詳細設計書

## 1. はじめに
### 1.1 ドキュメント概要
### 1.2 対象読者
### 1.3 関連ドキュメント

## 2. モジュール設計
### 2.1 ディレクトリ構成
### 2.2 モジュール一覧
### 2.3 依存関係

## 3. クラス設計
### 3.1 クラス図
### 3.2 各クラスの責務
### 3.3 インターフェース定義

## 4. API仕様書
### 4.1 エンドポイント一覧
### 4.2 リクエスト/レスポンス仕様
### 4.3 エラーレスポンス仕様

## 5. データベース設計
### 5.1 テーブル定義
### 5.2 インデックス設計
### 5.3 パーティショニング戦略

## 6. シーケンス図
### 6.1 主要処理フロー
### 6.2 エラー処理フロー

## 7. 状態遷移図
### 7.1 ビジネスロジックの状態遷移

## 8. エラーハンドリング設計
### 8.1 エラー分類
### 8.2 エラーレスポンス

## 9. ログ設計
### 9.1 ログレベル
### 9.2 ログフォーマット
### 9.3 ログ保持期間

## 10. 監視設計
### 10.1 監視メトリクス定義
### 10.2 アラート設計
### 10.3 ダッシュボード設計
### 10.4 通知先設計

## 11. バックアップ・リストア設計
### 11.1 バックアップの種類（データ層 vs インフラ構成）
### 11.2 バックアップ戦略（対象リソース、頻度、世代管理）
### 11.3 RTO/RPO の定義
### 11.4 リストア手順（データ層）
### 11.5 リストア手順（インフラ構成・IaC）
### 11.6 テスト計画

## 12. 実装方針（必須）
### 12.1 ファイル分割方針
### 12.2 ディレクトリ構成
### 12.3 モジュール分割
### 12.4 命名規則
### 12.5 技術標準の適用
### 12.6 推定行数と分割理由
```

---

**注意**: セクション12「実装方針」は**必須**です。
詳細は `.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.7_実装方針設計.md` を参照してください。

---

## 📁 ファイル分割の推奨

### 小規模プロジェクトの場合（推定300行以内）

```
docs/04_詳細設計書.md      # 1ファイルでOK
```

### 中〜大規模プロジェクトの場合（推定300行超）

**推奨：# 見出し1（セクション）ごとにファイル分割**

```
docs/04_詳細設計書/
├── 00_概要.md              # はじめに、目的、対象読者（短いため1ファイル）
├── 01_モジュール設計.md
├── 02_クラス設計.md
├── 03_API仕様書.md
├── 04_データベース設計.md
├── 05_シーケンス図.md
├── 06_状態遷移図.md
├── 07_エラーハンドリング設計.md
├── 08_ログ設計.md
├── 09_監視設計.md
├── 10_バックアップ・リストア設計.md
└── 11_実装方針.md          # 必須セクション
```

**理由：**
- ✅ 1ファイルあたり100〜300行程度に抑えられる
- ✅ セクションごとに独立して編集・レビュー可能
- ✅ Git差分が見やすい
- ✅ 複数人で並行作業しやすい

### ディレクトリ構成の例

```
docs/
├── 01_企画書.md
├── 02_要件定義書.md
├── 03_基本設計書.md
└── 04_詳細設計書/          # ディレクトリ化
    ├── README.md           # 目次・ナビゲーション
    ├── 00_概要.md
    ├── 01_モジュール設計.md
    ├── 02_クラス設計.md
    ├── 03_API仕様書.md
    ├── 04_データベース設計.md
    ├── 05_シーケンス図.md
    ├── 06_状態遷移図.md
    ├── 07_エラーハンドリング設計.md
    ├── 08_ログ設計.md
    ├── 09_監視設計.md
    ├── 10_バックアップ・リストア設計.md
    └── 11_実装方針.md
```

### README.md の例（ナビゲーション）

```markdown
# 詳細設計書

## 目次

1. [概要](./00_概要.md) - はじめに、目的、対象読者
2. [モジュール設計](./01_モジュール設計.md) - ディレクトリ構成、モジュール一覧
3. [クラス設計](./02_クラス設計.md) - クラス図、責務、インターフェース
4. [API仕様書](./03_API仕様書.md) - エンドポイント、リクエスト/レスポンス
5. [データベース設計](./04_データベース設計.md) - テーブル定義、インデックス
6. [シーケンス図](./05_シーケンス図.md) - 処理フロー
7. [状態遷移図](./06_状態遷移図.md) - ビジネスロジック
8. [エラーハンドリング設計](./07_エラーハンドリング設計.md) - エラー分類、レスポンス
9. [ログ設計](./08_ログ設計.md) - ログレベル、フォーマット
10. [監視設計](./09_監視設計.md) - メトリクス、アラート、ダッシュボード
11. [バックアップ・リストア設計](./10_バックアップ・リストア設計.md) - バックアップ戦略、リストア手順
12. [実装方針](./11_実装方針.md) - **必須** - ファイル分割、技術標準
```

### 判断基準

| プロジェクト規模 | ファイル構成 | 理由 |
|------------|----------|------|
| 小規模（〜300行） | 1ファイル | シンプル、管理しやすい |
| 中規模（300〜1000行） | セクション分割 | レビューしやすい、並行作業可能 |
| 大規模（1000行〜） | セクション分割 + サブセクション分割 | 必須（1ファイルでは管理不可能） |

### 設計書生成時の推奨フロー

1. **最初は1ファイルで生成**（`docs/04_詳細設計書.md`）
2. **行数を確認**
   - 300行以内 → そのまま
   - 300行超 → ファイル分割を提案
3. **ファイル分割実施**
   - ディレクトリ作成: `docs/04_詳細設計書/`
   - セクションごとに分割
   - README.md でナビゲーション提供

---

**作成日**: 2025-10-19
**更新日**: 2025-10-22（監視設計・バックアップ設計セクションを追加）
**対象フェーズ**: 設計
**重要度**: ⭐⭐⭐ 必須
