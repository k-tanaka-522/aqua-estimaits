# 2.3.13 基本設計書生成手順

## 目的

基本設計書を**漏れなく**生成するための手順を定義します。

**重要**: この手順を守ることで、「検討した代替案」「トレードオフ」などの重要なセクションが省略されることを防ぎます。

---

## 📋 生成前の準備

### 1. 必須ファイルを読む

**必ず全文読むファイル**:
- ✅ `.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.5_製造物_基本設計書構成.md`

**このファイルには以下が含まれています**:
- 目次構成（15章）
- 各セクションの記述方法
- 記載例（Good Example）
- 必須セクション（検討した代替案、トレードオフ）

### 2. 技術標準を確認

**参照するファイル**:
- `.claude/docs/40_standards/` 配下のすべてのファイル
- 特に選定した技術に関連する標準（Python、TypeScript、CloudFormation等）

### 3. 要件定義書を確認

**紐付けが必要**:
- `docs/02_要件定義書.md`
- 選定理由に「要件定義書 ○○節」の形で紐付ける

---

## ✅ 必須セクションチェックリスト

### アーキテクチャ設計（第4章）

**すべて必須、省略禁止**:

- [ ] 4.1.1 選定したパターン
- [ ] 4.1.2 選定理由 ⭐
- [ ] 4.1.3 検討した代替案 ⭐⭐ **省略禁止**
- [ ] 4.1.4 トレードオフ ⭐⭐ **省略禁止**

### 技術スタック（第4章）

**すべて必須、省略禁止**:

- [ ] 4.2.1 選定した技術
- [ ] 4.2.2 選定理由（要件定義書との紐付け） ⭐⭐
- [ ] 4.2.3 検討した代替案 ⭐⭐ **省略禁止**

### その他の選定セクション

**該当する場合は必須**:

- [ ] 6.4 データベース選定理由（RDB vs NoSQL）
- [ ] 7.2.2 認証・認可方式の選定理由
- [ ] 11.1.2 クラウドベンダー選定理由
- [ ] 11.1.3 クラウドベンダー検討した代替案

---

## 🚨 よくある省略ミス

### ❌ Bad: 選定理由だけ書いて終わり

```markdown
## 4. アーキテクチャ設計

### 4.1 アーキテクチャパターン

#### 4.1.1 選定したパターン
Multi-Account構成 + Transit Gateway Hub-and-Spoke

#### 4.1.2 選定理由
セキュリティとスケーラビリティのため

（ここで終わり、代替案とトレードオフがない） ← ❌
```

**問題点**:
- ❌ なぜこのパターンを選んだのか理由が薄い
- ❌ 他の選択肢を検討したか不明
- ❌ このパターンのデメリットが明記されていない

---

### ✅ Good: 代替案とトレードオフも必ず書く

```markdown
## 4. アーキテクチャ設計

### 4.1 アーキテクチャパターン

#### 4.1.1 選定したパターン

**Multi-Account構成 + Transit Gateway Hub-and-Spoke**

#### 4.1.2 選定理由

**要件定義書との紐付け**:
- 要件定義書 3.1.2節「共通基盤とアプリ基盤の分離」
- 要件定義書 3.2.3節「オンプレミス拠点との閉域接続」

**技術的根拠**:
- セキュリティ境界の明確化（アカウントレベルで分離）
- 独立したコスト管理（アカウント別に費用追跡）
- Transit Gatewayで拠点間の閉域接続を実現

#### 4.1.3 検討した代替案

| パターン | メリット | デメリット | 不採用理由 |
|---------|---------|----------|-----------|
| **Single Account** | ・シンプル<br>・初期コスト低 | ・セキュリティ境界が曖昧<br>・コスト分離不可 | 要件定義書 3.1.2節 の分離要件を満たせない |
| **VPC Peering** | ・設定がシンプル<br>・低コスト | ・拠点が増えるとメッシュ化<br>・ルート管理が複雑 | 将来的な拡張性に欠ける |
| **OU階層構造（複数OU）** | ・より細かい制御<br>・エンタープライズ向け | ・運用が複雑<br>・初期学習コスト高 | 検証目的には過剰、チーム3名では運用困難 |

#### 4.1.4 トレードオフ

**メリット**:
- ✅ セキュリティ境界の明確化（アカウントレベルで完全分離）
- ✅ 独立したコスト管理（Platform/Service別に費用追跡可能）
- ✅ Transit Gatewayで拠点追加が容易（将来の拡張性）

**デメリット**:
- ❌ アカウント間連携の複雑化（Export/Import必要）
- ❌ 初期構築コストの増加（Single Accountの約1.5倍）
- ❌ Transit Gatewayの料金（データ転送料、アタッチメント料金）

**判断**:
セキュリティ要件と将来の拡張性を優先し、Multi-Account構成を採用。
初期コスト増加は、要件定義書 1.3節 の予算範囲内に収まることを確認済み。
```

---

## 📝 生成フロー

### ステップ1: テンプレート読み込み

```
1. `.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.5_製造物_基本設計書構成.md` を**全文読む**
2. 目次構成（15章）を確認
3. 各章の必須セクションを確認
```

### ステップ2: ドキュメント構造決定

**小規模プロジェクト（推定300行以内）**:
```
docs/03_基本設計書.md  # 1ファイル
```

**中〜大規模プロジェクト（推定300行超）**:
```
docs/03_基本設計/
├── INDEX.md                                      # 目次・全体像・レビュー状況
├── 01_システムアーキテクチャ.md                   # 全体構成図、システム構成要素
├── 02_ネットワーク設計.md                        # VPC、サブネット、ルーティング（設計意図）
├── 02_(別紙)ネットワーク設計_パラメーター.md       # VPC CIDR、サブネットCIDR等の数値 ⭐
├── 03_セキュリティ設計.md                        # Security Groups、WAF、認証、暗号化（設計意図）
├── 03_(別紙)セキュリティ設計_パラメーター.md       # SG ルール、WAF設定値 ⭐
├── 04_監査・コンプライアンス設計.md                # ログ保管、証跡管理、法令準拠
├── 05_データベース設計.md                        # RDS構成、バックアップ戦略（設計意図）
├── 05_(別紙)データベース設計_パラメーター.md       # インスタンスクラス、ストレージ容量等 ⭐
├── 06_コンピュート設計.md                        # ECS、ALB、AutoScaling（設計意図）
├── 06_(別紙)コンピュート設計_パラメーター.md       # タスク数、CPU、メモリ等 ⭐
├── 07_フロントエンド設計.md                      # CloudFront、S3（該当する場合）
├── 07_(別紙)フロントエンド設計_パラメーター.md     # CloudFront設定、S3バケット設定 ⭐
├── 08_監視・アラート設計.md                      # CloudWatch、SNS、通知（設計意図）
├── 08_(別紙)監視・アラート設計_パラメーター.md     # 閾値、アラート条件等 ⭐
├── 09_CI_CD設計.md                              # パイプライン、デプロイ戦略
├── 10_CloudFormation構成方針.md                 # ファイル分割3原則、ディレクトリ構造
├── 11_非機能要件実現方針.md                      # 性能、可用性
├── 12_災害対策・BCP.md                          # DR、バックアップ
└── 13_移行計画.md                               # スケジュール、データ移行
```

**重要**: 詳細な構成は `.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.5_製造物_基本設計書構成.md` を参照

### ステップ3: セクションごとに生成

**必ず含めるセクション**:

1. **アーキテクチャ設計**
   - 選定したパターン
   - 選定理由（要件定義書との紐付け）
   - **検討した代替案**（表形式推奨）
   - **トレードオフ**（メリット・デメリット明記）

2. **技術スタック**
   - 選定した技術
   - 選定理由（要件定義書との紐付け）
   - **検討した代替案**（表形式推奨）

3. **参照した技術標準**
   - `.claude/docs/40_standards/` から該当する標準を明記

### ステップ4: 生成後チェック

**チェックリスト**:

- [ ] すべての必須セクションが含まれている
- [ ] 「検討した代替案」が空欄でない
- [ ] 「トレードオフ」が空欄でない
- [ ] 選定理由に要件定義書との紐付けがある（「要件定義書 ○○節」）
- [ ] 技術標準への参照がある（`.claude/docs/40_standards/○○.md`）

---

## 🎯 記述の具体性チェック

### ❌ Bad: 抽象的すぎる

```markdown
#### 4.1.2 選定理由
スケーラビリティと保守性のため
```

**問題**: なぜスケーラブルなのか、どう保守しやすいのか不明

### ✅ Good: 具体的

```markdown
#### 4.1.2 選定理由

**要件定義書との紐付け**:
- 要件定義書 3.2.1節「将来的に他のServiceアカウント追加の可能性」

**技術的根拠**:
- Transit Gatewayで新規VPCをアタッチするだけで接続可能
- アカウント分離により、各チームが独立してリソース管理可能
- CloudFormation StackSetsで同じ構成を複数アカウントに展開可能

**スケーラビリティの具体例**:
- 現在: Platform 1アカウント + Service 1アカウント
- 将来: Platform 1アカウント + Service 3アカウント（追加2アカウント）
- 追加作業: Transit Gateway Attachment追加のみ（約1時間）
```

---

## 📚 参考資料

### テンプレート
- `.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.5_製造物_基本設計書構成.md`

### 技術標準
- `.claude/docs/40_standards/`

### 記載例
- `.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.10.5_Good_Bad_Example集.md`

---

**作成日**: 2025-10-23
**対象フェーズ**: 設計
**重要度**: ⭐⭐⭐ 必須
