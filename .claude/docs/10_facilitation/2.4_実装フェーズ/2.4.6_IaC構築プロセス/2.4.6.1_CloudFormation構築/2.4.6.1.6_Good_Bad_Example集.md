# 2.4.6.1.6 CloudFormation Good_Bad_Example集

## 目的

CloudFormationのよくある間違いパターンと推奨パターンを示します。

---

## 🔄 実例パターン集

### 1. dry-run

#### ❌ Bad Example

```bash
# ❌ 本番環境に直接デプロイ
aws cloudformation deploy \
  --stack-name myapp-prod \
  --template-file template.yaml
```

#### ✅ Good Example

```bash
# ✅ Change Setsで事前確認
aws cloudformation create-change-set \
  --stack-name myapp-prod \
  --template-body file://template.yaml \
  --change-set-name update-check
```

---

### 2. シークレット管理

#### ❌ Bad Example

```yaml
# ❌ パスワードをハードコード
Parameters:
  DBPassword:
    Type: String
    Default: "my-secret-password"  # ❌ 危険
```

#### ✅ Good Example

```yaml
# ✅ Secrets Manager から取得
Resources:
  DBSecret:
    Type: AWS::SecretsManager::Secret
    Properties:
      GenerateSecretString:
        SecretStringTemplate: '{"username": "admin"}'
        GenerateStringKey: "password"
```

---

### 3. セキュリティグループ

#### ❌ Bad Example

```yaml
# ❌ 全開放
SecurityGroupIngress:
  - IpProtocol: tcp
    FromPort: 0
    ToPort: 65535
    CidrIp: 0.0.0.0/0  # ❌ 危険
```

#### ✅ Good Example

```yaml
# ✅ 必要最小限のポート開放
SecurityGroupIngress:
  - IpProtocol: tcp
    FromPort: 443
    ToPort: 443
    CidrIp: 10.0.0.0/16  # ✅ VPC内のみ
```

---

## 📝 まとめ

### 必ず守るべきこと ⭐⭐⭐

1. **dry-run必須**: Change Setsで事前確認
2. **シークレット管理**: Secrets Manager使用
3. **セキュリティ**: 最小権限、ポート制限

---

**作成日**: 2025-10-19
**対象フェーズ**: 実装
**重要度**: ⭐⭐⭐ 必須
