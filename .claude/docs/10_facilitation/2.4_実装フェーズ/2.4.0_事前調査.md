# 2.4.0 事前調査（実装フェーズ）

## 📋 このドキュメントの目的

実装フェーズ開始前に、**技術標準（`.claude/docs/40_standards/`）を最優先で参照**し、最新のライブラリ・ベストプラクティスを調査することで、高品質なコード生成を実現する。

**重要:** 設計フェーズで決定した技術スタックに対して、**どう実装するか**を技術標準に基づいて確認する。

---

## ⭐⭐⭐ 技術標準（`.claude/docs/40_standards/`）の参照（最重要）

### 実装前に必ず参照すべき技術標準ファイル

実装フェーズでは、**コード生成前に必ず技術標準（`.claude/docs/40_standards/`）を参照**する。

#### アプリケーション開発標準

**設計フェーズで決定した言語・フレームワークに応じて参照:**

1. **Python プロジェクト**
   - `4.5 Python規約` ⭐⭐⭐必須
   - プロジェクト構成、コーディング規約、Good/Bad Example
   - 推奨ライブラリ、テストパターン

2. **Node.js/TypeScript プロジェクト**
   - `4.6 Node.js/TypeScript規約` ⭐⭐⭐必須
   - プロジェクト構成、TypeScript設定、ESLint/Prettier設定
   - 推奨フレームワーク、Good/Bad Example

3. **C# .NET Core プロジェクト**
   - `4.7 C# .NET Core規約` ⭐⭐⭐必須
   - ソリューション構成、命名規則、DI/IoC パターン
   - 推奨ライブラリ、Good/Bad Example

4. **Go言語プロジェクト**
   - `4.8 Go言語規約` ⭐⭐⭐必須
   - プロジェクト構成、命名規則、エラーハンドリング
   - 推奨ライブラリ、Good/Bad Example

#### インフラ開発標準

**設計フェーズで決定したIaC方式に応じて参照:**

1. **AWS CloudFormation**
   - `4.3 AWS CloudFormation規約` ⭐⭐⭐必須
   - テンプレート構成、命名規則、セキュリティ設定
   - Good/Bad Example、推奨パターン

2. **Terraform**
   - `4.4 Terraform規約` ⭐⭐⭐必須
   - ディレクトリ構成、命名規則、状態管理
   - Good/Bad Example、推奨パターン

#### セキュリティ・運用標準（全プロジェクト必須）

1. **セキュリティ・運用基準**
   - `4.9 セキュリティ・運用基準` ⭐⭐⭐全プロジェクト必須
   - シークレット管理、認証・認可、ログ・監視
   - セキュリティチェックリスト

---

## 🔍 実装フェーズの事前調査フロー

```mermaid
flowchart TB
    A[実装フェーズ開始] --> B[設計書から技術スタック確認]
    B --> C{技術標準（`.claude/docs/40_standards/`）<br/>該当ページ特定}

    C --> D[技術標準標準を精読]
    D --> E[プロジェクト構成確認]
    D --> F[コーディング規約確認]
    D --> G[Good/Bad Example確認]
    D --> H[推奨ライブラリ確認]

    E --> I[WebSearch:<br/>最新ライブラリバージョン]
    F --> I
    G --> I
    H --> I

    I --> J[WebSearch:<br/>最新ベストプラクティス]
    J --> K[WebSearch:<br/>セキュリティアップデート]
    K --> L[技術標準 + WebSearch<br/>統合知識ベース作成]

    L --> M[コード生成開始]
    M --> N{技術標準<br/>準拠確認}

    N -->|違反| O[修正]
    O --> N

    N -->|準拠| P[実装継続]

    style C fill:#fff3cd
    style D fill:#ffc107
    style L fill:#d4edda
    style N fill:#fff3cd
```

---

## 📂 事前調査の項目

### 1. 技術標準（`.claude/docs/40_standards/`）の精読 ⭐⭐⭐

#### 目的
設計フェーズで決定した技術に対して、**社内標準を遵守したコード生成**を行う。

#### 調査内容

**プロジェクト構成:**
```
技術標準: 4.5 Python規約 の場合
→ ディレクトリ構成、ファイル命名規則、モジュール分割方針を確認

例:
my-project/
├── src/
│   ├── app/          # アプリケーションロジック
│   ├── domain/       # ドメインモデル
│   ├── infrastructure/  # インフラ層
│   └── main.py       # エントリーポイント
├── tests/
├── docs/
└── requirements.txt
```

**コーディング規約:**
```python
# 技術標準: 4.5 Python規約 の Good Example

class UserService:
    """ユーザー管理サービス

    Args:
        user_repository: ユーザーリポジトリ
    """

    def __init__(self, user_repository: UserRepository):
        self._user_repository = user_repository

    def create_user(self, name: str, email: str) -> User:
        """ユーザーを作成

        Args:
            name: ユーザー名
            email: メールアドレス

        Returns:
            作成されたユーザー

        Raises:
            ValidationError: バリデーションエラー
        """
        # バリデーション
        if not name or not email:
            raise ValidationError("名前とメールアドレスは必須です")

        # ドメインモデル生成
        user = User(name=name, email=email)

        # 永続化
        return self._user_repository.save(user)
```

**Bad Example の確認:**
```python
# 技術標準: 4.5 Python規約 の Bad Example

def create_user(n, e):  # ❌ 型ヒントなし、変数名不明確
    if n and e:         # ❌ バリデーション不十分
        u = User(n, e)  # ❌ 変数名不明確
        save(u)         # ❌ 戻り値なし
```

**推奨ライブラリ:**
```
技術標準: 4.5 Python規約 の場合
→ FastAPI, SQLAlchemy, Pydantic, pytest, black, flake8, mypy等を確認
```

---

### 2. 最新ライブラリバージョン調査（WebSearch）

#### 目的
技術標準で推奨されているライブラリの**最新安定版**と**セキュリティアップデート**を確認する。

#### WebSearch クエリ例

**Python プロジェクト:**
```
検索クエリ:
- "FastAPI latest stable version 2025"
- "SQLAlchemy 2.x migration guide"
- "Pydantic v2 best practices 2025"
- "pytest latest version security updates"
```

**Node.js/TypeScript プロジェクト:**
```
検索クエリ:
- "Express.js latest version 2025"
- "TypeScript 5.x best practices"
- "Node.js LTS version 2025"
- "npm security audit guide 2025"
```

**インフラ（Terraform）:**
```
検索クエリ:
- "Terraform AWS provider latest version 2025"
- "Terraform best practices 2025"
- "Terraform state management security"
```

#### 記録内容

調査結果を `.claude-state/research-implementation-{timestamp}.md` に記録:

```markdown
# 実装フェーズ事前調査 - {プロジェクト名}

**調査日**: 2025-01-27
**対象技術**: Python (FastAPI)

## 技術標準確認

**参照ページ**: 4.5 Python規約

**プロジェクト構成**:
- src/ 配下にアプリケーションロジック
- tests/ 配下にテストコード
- requirements.txt でライブラリ管理

**コーディング規約**:
- 型ヒント必須
- Docstring (Google Style)
- 変数名は意味のある英単語

**推奨ライブラリ**:
- FastAPI (Webフレームワーク)
- SQLAlchemy (ORM)
- Pydantic (バリデーション)
- pytest (テスト)

## 最新バージョン調査（WebSearch）

**FastAPI**:
- 最新版: 0.109.0 (2025-01-15リリース)
- セキュリティ: CVE-2024-xxxxx 修正済み
- 推奨: 0.109.x

**SQLAlchemy**:
- 最新版: 2.0.25
- 推奨: 2.0.x（1.4.xからの移行が完了）

**Pydantic**:
- 最新版: 2.5.3
- v2で大幅な性能改善
- 推奨: 2.5.x

## ベストプラクティス（WebSearch）

**FastAPI 2025年のベストプラクティス**:
- 依存性注入（DI）の活用
- Pydantic v2 での型安全性向上
- async/await の適切な使用
- OpenAPI自動生成の活用

**セキュリティ対策**:
- 環境変数でシークレット管理（`.claude/docs/40_standards/49_security.md`準拠）
- CORS設定の厳格化
- レート制限の実装
- 入力バリデーション強化

## 実装方針

1. `.claude/docs/40_standards/41_python.md` Python規約に準拠したプロジェクト構成
2. FastAPI 0.109.x + SQLAlchemy 2.0.x + Pydantic 2.5.x
3. 型ヒント・Docstring完備
4. pytest によるテストカバレッジ80%以上
5. `.claude/docs/40_standards/49_security.md` セキュリティ基準遵守
```

---

### 3. 最新ベストプラクティス調査（WebSearch）

#### 目的
2025年時点での**モダンな実装パターン**を調査し、技術標準標準と組み合わせる。

#### WebSearch クエリ例

**アーキテクチャパターン:**
```
検索クエリ:
- "Clean Architecture Python 2025"
- "Hexagonal Architecture FastAPI example"
- "Domain-Driven Design Python best practices"
```

**CI/CDパターン:**
```
検索クエリ:
- "GitHub Actions Python CI/CD 2025"
- "AWS CodePipeline best practices 2025"
- "Docker multi-stage build Python"
```

**テストパターン:**
```
検索クエリ:
- "pytest fixtures best practices 2025"
- "Python integration testing patterns"
- "API testing with FastAPI 2025"
```

#### Good Example

```markdown
## WebSearch結果: Clean Architecture Python 2025

**推奨構成**:
```
src/
├── domain/          # ドメイン層（ビジネスロジック）
│   ├── models/
│   ├── services/
│   └── repositories/  # インターフェースのみ
├── application/     # アプリケーション層（ユースケース）
│   └── usecases/
├── infrastructure/  # インフラ層（実装詳細）
│   ├── database/
│   ├── api/
│   └── config/
└── main.py          # エントリーポイント
```

**依存関係のルール**:
- domain: 他の層に依存しない
- application: domainに依存
- infrastructure: domain, applicationに依存
- 依存性逆転の原則（DIP）を適用
```

---

### 4. セキュリティアップデート調査（WebSearch + `.claude/docs/40_standards/49_security.md`）

#### 目的
最新のセキュリティ脅威と対策を調査し、**`.claude/docs/40_standards/49_security.md` セキュリティ基準**に準拠する。

#### WebSearch クエリ例

```
検索クエリ:
- "Python security vulnerabilities 2025"
- "FastAPI security best practices 2025"
- "OWASP Top 10 2025"
- "AWS security best practices 2025"
```

#### `.claude/docs/40_standards/49_security.md` セキュリティ基準の確認

**必須対応事項:**
1. **シークレット管理**
   - 環境変数・AWS Secrets Manager使用
   - ハードコード禁止

2. **認証・認可**
   - JWT or OAuth2.0
   - RBAC（Role-Based Access Control）

3. **ログ・監視**
   - CloudWatch Logs
   - エラーログ・アクセスログ記録

4. **データ保護**
   - TLS 1.2以上
   - DB暗号化（at-rest, in-transit）

#### Good Example

```python
# `.claude/docs/40_standards/49_security.md` セキュリティ基準準拠コード

import os
from functools import lru_cache
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    """環境変数から設定を読み込む（`.claude/docs/40_standards/49_security.md`準拠）"""

    # データベース接続（シークレット）
    database_url: str

    # API キー（シークレット）
    api_key: str

    # JWT設定
    jwt_secret_key: str
    jwt_algorithm: str = "HS256"

    class Config:
        env_file = ".env"  # 開発環境のみ
        env_file_encoding = "utf-8"

@lru_cache()
def get_settings() -> Settings:
    """設定シングルトン"""
    return Settings()

# ❌ Bad Example（ハードコード）
# DATABASE_URL = "postgresql://user:password@localhost/db"
```

---

## 🚀 実装開始前のチェックリスト

### 技術標準（`.claude/docs/40_standards/`）確認

- [ ] 該当する技術標準（`.claude/docs/40_standards/`）ページを特定した
- [ ] プロジェクト構成を確認した
- [ ] コーディング規約を確認した
- [ ] Good/Bad Exampleを確認した
- [ ] 推奨ライブラリを確認した
- [ ] セキュリティ基準（`.claude/docs/40_standards/49_security.md`）を確認した

### 最新情報調査

- [ ] 推奨ライブラリの最新安定版を調査した
- [ ] セキュリティアップデート情報を確認した
- [ ] 最新ベストプラクティスを調査した
- [ ] 類似プロジェクトの実装例を調査した

### 調査結果記録

- [ ] `.claude-state/research-implementation-{timestamp}.md` に記録した
- [ ] 技術標準準拠ポイントを明記した
- [ ] WebSearch結果を統合した
- [ ] 実装方針を明確にした

---

## 💡 実装フェーズ事前調査のコツ

### 1. 技術標準を最優先

**Good:**
```
1. 技術標準（`.claude/docs/40_standards/`）を精読
2. WebSearchで最新情報を補完
3. 技術標準に準拠した実装方針を策定
```

**Bad:**
```
1. WebSearchで最新トレンドを調査
2. 技術標準を無視して実装
→ 社内標準違反、レビュー差し戻し
```

---

### 2. セキュリティは妥協しない

**Good:**
```
- `.claude/docs/40_standards/49_security.md` セキュリティ基準を必ず確認
- OWASP Top 10 を考慮
- シークレット管理を徹底
```

**Bad:**
```
- セキュリティは後回し
- 開発環境でハードコード
→ 本番環境で情報漏洩リスク
```

---

### 3. 実装前に全体像を把握

**Good:**
```
- プロジェクト構成を事前に設計
- ディレクトリ構造を明確化
- 依存関係を整理
```

**Bad:**
```
- いきなりコーディング開始
- ファイル配置が不統一
→ 保守性低下
```

---

## 📝 まとめ

### 実装フェーズ事前調査の本質

**「技術標準（`.claude/docs/40_standards/`）を基盤に、最新ベストプラクティスを組み合わせる」**

1. **技術標準標準を最優先** - 社内規約遵守
2. **WebSearchで最新情報補完** - モダンな実装
3. **セキュリティ基準遵守** - `.claude/docs/40_standards/49_security.md`必須
4. **調査結果を記録** - `.claude-state/` に保存

これにより、**高品質で保守性の高いコード**を生成できる。

### AIファシリテーターとしての心構え

1. **コード生成前に必ず技術標準参照**
2. **Good/Bad Exampleを活用**
3. **セキュリティは妥協しない**
4. **最新ベストプラクティスを取り入れる**
5. **ユーザーに実装方針を説明してから生成**

---

**最終更新**: 2025-10-19
**作成者**: Claude (AI開発ファシリテーター)
