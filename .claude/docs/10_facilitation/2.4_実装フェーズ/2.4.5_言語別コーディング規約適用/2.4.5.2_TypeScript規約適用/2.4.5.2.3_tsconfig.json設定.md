# 2.4.5.2.3 tsconfig.json設定

## 目的

TypeScriptコンパイラの設定を `.claude/docs/40_standards/42_typescript.md` に準拠して行います。

---

## 📄 推奨tsconfig.json

```json
{
  "compilerOptions": {
    /* 言語とモジュール */
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],

    /* モジュール解決 */
    "moduleResolution": "node",
    "esModuleInterop": true,
    "resolveJsonModule": true,

    /* 出力設定 */
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,

    /* 型チェック（最重要） ⭐⭐⭐ */
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitThis": true,
    "alwaysStrict": true,

    /* 追加のチェック */
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,

    /* その他 */
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "allowSyntheticDefaultImports": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "tests"]
}
```

---

## ✅ 重要な設定項目

### 1. `strict: true` ⭐⭐⭐最重要

**効果**:
- すべての厳格な型チェックを有効化
- 型安全性を最大化

**以下の設定が自動的に有効化**:
- `noImplicitAny`
- `strictNullChecks`
- `strictFunctionTypes`
- `strictBindCallApply`
- `strictPropertyInitialization`
- `noImplicitThis`
- `alwaysStrict`

---

### 2. `moduleResolution: "node"` ⭐⭐⭐

**効果**:
- Node.jsのモジュール解決方法を使用
- `node_modules` からのインポートが正しく解決される

**例**:

```typescript
import express from 'express';  // ✅ 正しく解決
```

---

### 3. `esModuleInterop: true` ⭐⭐⭐

**効果**:
- CommonJSとESモジュールの互換性を提供
- `import * as` なしでインポート可能

**例**:

```typescript
// ❌ esModuleInterop: false
import * as express from 'express';

// ✅ esModuleInterop: true
import express from 'express';
```

---

### 4. `noImplicitAny: true` ⭐⭐⭐

**効果**:
- 型が推論できない場合にエラー
- `any` の暗黙的な使用を防ぐ

**例**:

```typescript
// ❌ noImplicitAny: true でエラー
function getUser(userId) {  // Error: Parameter 'userId' implicitly has an 'any' type
  return db.query(userId);
}

// ✅ 型を明示
function getUser(userId: number): Promise<User> {
  return db.query(userId);
}
```

---

### 5. `strictNullChecks: true` ⭐⭐⭐

**効果**:
- `null` と `undefined` を明示的に扱う
- Null参照エラーを防ぐ

**例**:

```typescript
// ❌ strictNullChecks: true でエラー
function getUser(userId: number): User {
  const user = db.query(userId);  // User | null
  return user;  // Error: Type 'null' is not assignable to type 'User'
}

// ✅ nullチェック
function getUser(userId: number): User | null {
  const user = db.query(userId);
  if (!user) {
    return null;
  }
  return user;
}
```

---

### 6. `noUnusedLocals: true` ⭐⭐

**効果**:
- 未使用のローカル変数を検出

**例**:

```typescript
// ❌ noUnusedLocals: true でエラー
function processData(data: string): string {
  const unused = 'not used';  // Error: 'unused' is declared but its value is never read
  return data.toUpperCase();
}

// ✅ 使用する変数のみ宣言
function processData(data: string): string {
  return data.toUpperCase();
}
```

---

### 7. `skipLibCheck: true` ⭐推奨

**効果**:
- `node_modules` 内の `.d.ts` ファイルの型チェックをスキップ
- ビルド時間を短縮

**注意**:
- 自分のコードの型チェックには影響しない

---

## 📋 プロジェクトタイプ別設定

### Node.js APIサーバー

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "moduleResolution": "node",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true
  }
}
```

---

### ライブラリ開発

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "esnext",
    "lib": ["ES2020"],
    "declaration": true,
    "declarationMap": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true
  }
}
```

---

### モノレポ（複数パッケージ）

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "composite": true,
    "declaration": true,
    "paths": {
      "@myorg/common": ["../common/src"],
      "@myorg/api": ["../api/src"]
    }
  },
  "references": [
    { "path": "../common" },
    { "path": "../api" }
  ]
}
```

---

## ❌ Bad Example: 不適切な設定

```json
{
  "compilerOptions": {
    "target": "ES5",              // ❌ 古い
    "strict": false,              // ❌ 型チェックが甘い
    "noImplicitAny": false,       // ❌ any許容
    "skipLibCheck": false         // ❌ ビルドが遅い
  }
}
```

**問題点**:
- 型安全性が低い
- ビルドが遅い
- バグが混入しやすい

---

## ✅ Good Example: 推奨設定

```json
{
  "compilerOptions": {
    "target": "ES2020",           // ✅ 最新
    "module": "commonjs",
    "lib": ["ES2020"],
    "strict": true,               // ✅ 型チェック厳格
    "esModuleInterop": true,      // ✅ 互換性
    "skipLibCheck": true,         // ✅ ビルド高速化
    "moduleResolution": "node",
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "tests"]
}
```

**改善点**:
- ✅ 厳格な型チェック
- ✅ ビルド高速化
- ✅ モジュール解決が正確

---

## 🔍 設定チェックリスト

コード生成前に確認：

1. [ ] `strict: true` が有効
2. [ ] `moduleResolution: "node"` が設定済み
3. [ ] `esModuleInterop: true` が設定済み
4. [ ] `skipLibCheck: true` が設定済み（ビルド高速化）
5. [ ] `outDir` と `rootDir` が正しく設定
6. [ ] `include` と `exclude` が正しく設定

---

**作成日**: 2025-10-19
**対象フェーズ**: 実装
**重要度**: ⭐⭐⭐ 必須
