# 2.4.5.2.2 TypeScriptプロジェクト構成適用

## 目的

`.claude/docs/40_standards/42_typescript.md` に準拠したTypeScriptプロジェクト構成を実装します。

---

## 📁 標準プロジェクト構成

```
myproject/
├── src/
│   ├── index.ts          # エントリーポイント
│   ├── app.ts            # アプリケーション初期化
│   ├── api/              # APIエンドポイント
│   │   ├── routes.ts
│   │   ├── middleware.ts
│   │   └── validators.ts
│   ├── models/           # データモデル（型定義）
│   │   ├── user.ts
│   │   └── product.ts
│   ├── services/         # ビジネスロジック
│   │   ├── userService.ts
│   │   └── productService.ts
│   ├── repositories/     # データアクセス層（optional）
│   │   └── userRepository.ts
│   └── utils/            # ユーティリティ
│       ├── logger.ts
│       └── errors.ts
├── tests/
│   ├── api/
│   │   └── routes.test.ts
│   └── services/
│       └── userService.test.ts
├── dist/                 # ビルド出力
├── .env.example
├── .eslintrc.json
├── .prettierrc
├── tsconfig.json
├── jest.config.js
├── package.json
└── README.md
```

---

## ✅ 各ファイル・ディレクトリの役割

### 1. `src/` - アプリケーションコード

**目的**: すべてのTypeScriptコードをここに集約

**ルール**:
- ✅ 層別設計を徹底（api, models, services, repositories, utils）
- ✅ ビジネスロジックは `services/` に配置
- ✅ 型定義は `models/` に配置
- ✅ PascalCase（型）、camelCase（変数・関数）

---

### 2. `src/models/` - データモデル（型定義）

**目的**: interfaceやtypeを定義

**例**:

```typescript
// src/models/user.ts
export interface User {
  id: number;
  name: string;
  email: string;
  createdAt: Date;
}

export interface CreateUserDto {
  name: string;
  email: string;
}

export interface UpdateUserDto {
  name?: string;
  email?: string;
}
```

---

### 3. `src/services/` - ビジネスロジック ⭐重要

**目的**: ビジネスルールを実装

**原則**:
- ✅ APIエンドポイントから呼び出される
- ✅ Repositoryを使用
- ✅ ビジネスロジックのテストが容易

**例**:

```typescript
// src/services/userService.ts
import { User, CreateUserDto } from '../models/user';
import { UserRepository } from '../repositories/userRepository';
import { UserNotFoundError } from '../utils/errors';
import logger from '../utils/logger';

export class UserService {
  constructor(private userRepository: UserRepository) {}

  async getUser(userId: number): Promise<User> {
    const user = await this.userRepository.findById(userId);
    if (!user) {
      logger.warn(`User ${userId} not found`);
      throw new UserNotFoundError(`User ${userId} not found`);
    }
    return user;
  }

  async createUser(dto: CreateUserDto): Promise<User> {
    logger.info(`Creating user: ${dto.email}`);
    return await this.userRepository.create(dto);
  }
}
```

---

### 4. `src/api/` - APIエンドポイント

**目的**: HTTP APIのエンドポイントを定義

**例**: Express

```typescript
// src/api/routes.ts
import { Router } from 'express';
import { UserService } from '../services/userService';
import { CreateUserDto } from '../models/user';
import { validateCreateUser } from './validators';

const router = Router();
const userService = new UserService(/* repository */);

router.get('/users/:id', async (req, res, next) => {
  try {
    const userId = parseInt(req.params.id);
    const user = await userService.getUser(userId);
    res.json(user);
  } catch (error) {
    next(error);
  }
});

router.post('/users', validateCreateUser, async (req, res, next) => {
  try {
    const dto: CreateUserDto = req.body;
    const user = await userService.createUser(dto);
    res.status(201).json(user);
  } catch (error) {
    next(error);
  }
});

export default router;
```

---

### 5. `tsconfig.json` - TypeScript設定 ⭐⭐⭐必須

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node",
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "tests"]
}
```

**重要な設定**:
- ✅ `strict: true` - 厳格な型チェック
- ✅ `esModuleInterop: true` - CommonJSとの互換性
- ✅ `skipLibCheck: true` - node_modules の型チェックスキップ

---

### 6. `.eslintrc.json` - ESLint設定

```json
{
  "parser": "@typescript-eslint/parser",
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier"
  ],
  "plugins": ["@typescript-eslint"],
  "env": {
    "node": true,
    "es2020": true
  },
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/explicit-function-return-type": "warn"
  }
}
```

---

### 7. `package.json` - パッケージ管理

```json
{
  "name": "myproject",
  "version": "1.0.0",
  "scripts": {
    "build": "tsc",
    "start": "node dist/index.js",
    "dev": "ts-node-dev --respawn src/index.ts",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:cov": "jest --coverage",
    "lint": "eslint src/**/*.ts",
    "format": "prettier --write \"src/**/*.ts\""
  },
  "dependencies": {
    "express": "^4.18.0"
  },
  "devDependencies": {
    "@types/express": "^4.17.0",
    "@types/jest": "^29.5.0",
    "@types/node": "^20.0.0",
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "eslint": "^8.0.0",
    "jest": "^29.5.0",
    "prettier": "^3.0.0",
    "ts-jest": "^29.1.0",
    "ts-node-dev": "^2.0.0",
    "typescript": "^5.0.0"
  }
}
```

---

## ❌ Bad Example: 構成が不適切

```
myproject/
├── index.ts          # ❌ すべて1ファイル
├── utils.ts
└── test.ts
```

**問題点**:
- 層別設計がない
- ファイルが肥大化
- テストが不十分

---

## ✅ Good Example: 技術標準に準拠

```
myproject/
├── src/
│   ├── api/          # ✅ API層
│   ├── models/       # ✅ 型定義
│   ├── services/     # ✅ ビジネスロジック
│   ├── repositories/ # ✅ データアクセス層
│   └── utils/
└── tests/
    ├── api/
    └── services/     # ✅ 層ごとにテスト
```

**改善点**:
- ✅ 層別設計
- ✅ 責務が明確
- ✅ テストが容易

---

**作成日**: 2025-10-19
**対象フェーズ**: 実装
**重要度**: ⭐⭐⭐ 必須
