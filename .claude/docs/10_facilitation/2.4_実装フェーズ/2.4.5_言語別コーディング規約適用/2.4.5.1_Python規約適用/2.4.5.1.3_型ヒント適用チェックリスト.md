# 2.4.5.1.3 Python型ヒント適用チェックリスト

## 目的

Pythonコード生成時に型ヒント（Type Hints）を正しく適用し、`.claude/docs/40_standards/41_python.md` に準拠します。

---

## ✅ 型ヒント適用チェックリスト

### 1. 関数の引数 ⭐⭐⭐必須

- [ ] すべての引数に型ヒントを付与
- [ ] Optional型の適切な使用
- [ ] Union型の適切な使用

**例**:

```python
from typing import Optional, Union

def get_user(
    user_id: int,  # ✅ 基本型
    include_deleted: bool = False,  # ✅ デフォルト値付き
    email: Optional[str] = None  # ✅ Optional型
) -> Optional[User]:
    pass
```

---

### 2. 関数の戻り値 ⭐⭐⭐必須

- [ ] すべての関数に戻り値の型ヒント
- [ ] Noneを返す場合は `Optional` または `None` を明示
- [ ] 複数の型を返す場合は `Union` を使用

**例**:

```python
def get_user(user_id: int) -> Optional[User]:
    """ユーザーを取得。存在しない場合はNone"""
    pass

def validate_email(email: str) -> bool:
    """メールアドレスを検証。有効ならTrue"""
    pass

def get_user_or_error(user_id: int) -> Union[User, str]:
    """ユーザーを取得。エラー時はエラーメッセージを返す"""
    pass
```

---

### 3. クラス属性 ⭐⭐必須

- [ ] クラス属性に型ヒント
- [ ] インスタンス属性に型ヒント
- [ ] `__init__` メソッドの引数に型ヒント

**例**:

```python
from typing import List

class UserService:
    """ユーザーサービス"""

    # クラス属性
    cache_enabled: bool = True

    def __init__(self, repository: UserRepository):
        # インスタンス属性
        self.repository: UserRepository = repository
        self.users: List[User] = []
```

---

### 4. コレクション型 ⭐⭐重要

- [ ] `List[T]`、`Dict[K, V]`、`Set[T]`、`Tuple[T, ...]` を使用
- [ ] Python 3.9以降は `list[T]`、`dict[K, V]` も使用可能

**例**:

```python
from typing import List, Dict, Set, Tuple

def get_users() -> List[User]:
    """ユーザーリストを取得"""
    pass

def get_user_mapping() -> Dict[int, User]:
    """ユーザーIDとユーザーのマッピングを取得"""
    pass

def get_unique_emails() -> Set[str]:
    """重複のないメールアドレスセットを取得"""
    pass

def get_user_tuple() -> Tuple[int, str, str]:
    """ユーザー情報をタプルで取得（id, name, email）"""
    pass
```

---

### 5. 非同期関数 ⭐⭐重要

- [ ] `async def` の戻り値は `Awaitable` または `Coroutine`
- [ ] 実際には直接型を指定（`async def func() -> User:`）

**例**:

```python
from typing import Optional

async def get_user_async(user_id: int) -> Optional[User]:
    """非同期でユーザーを取得"""
    pass

async def save_user_async(user: User) -> None:
    """非同期でユーザーを保存"""
    pass
```

---

### 6. ジェネリクス（高度） ⭐オプション

- [ ] `TypeVar` を使用してジェネリック関数を定義
- [ ] `Generic[T]` を使用してジェネリッククラスを定義

**例**:

```python
from typing import TypeVar, Generic, List

T = TypeVar('T')

def first_element(items: List[T]) -> Optional[T]:
    """リストの最初の要素を取得"""
    return items[0] if items else None

class Repository(Generic[T]):
    """汎用リポジトリ"""

    def find_by_id(self, id: int) -> Optional[T]:
        pass

# 使用例
user_repo: Repository[User] = Repository()
```

---

## ❌ Bad Example: 型ヒントなし

```python
# ❌ 引数の型が不明
def get_user(user_id):
    pass

# ❌ 戻り値の型が不明
def validate_email(email):
    return True

# ❌ クラス属性の型が不明
class UserService:
    def __init__(self, repository):
        self.repository = repository
```

**問題点**:
- エディタの補完が効かない
- 型チェック（mypy）が効かない
- 可読性が低い

---

## ✅ Good Example: 型ヒント完備

```python
from typing import Optional, List
from src.models.user import User
from src.repositories.user_repository import UserRepository

def get_user(user_id: int) -> Optional[User]:
    """
    ユーザーIDからユーザーを取得。

    Args:
        user_id (int): ユーザーID

    Returns:
        Optional[User]: ユーザー情報。存在しない場合はNone
    """
    pass

def validate_email(email: str) -> bool:
    """
    メールアドレスを検証。

    Args:
        email (str): メールアドレス

    Returns:
        bool: 有効ならTrue
    """
    return "@" in email

class UserService:
    """ユーザーサービス"""

    def __init__(self, repository: UserRepository):
        self.repository: UserRepository = repository
        self.users: List[User] = []

    async def get_users(self) -> List[User]:
        """すべてのユーザーを取得"""
        return await self.repository.find_all()
```

**改善点**:
- ✅ すべての引数・戻り値に型ヒント
- ✅ クラス属性に型ヒント
- ✅ docstringと型ヒントが一致
- ✅ エディタの補完が効く

---

## 🔍 型チェックツール（mypy）

### インストール

```bash
pip install mypy
```

### 実行

```bash
mypy src/
```

### 設定（mypy.ini）

```ini
[mypy]
python_version = 3.11
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
```

---

## 📝 コード生成前のチェック

コード生成前に以下を確認：

1. [ ] すべての関数に引数・戻り値の型ヒント
2. [ ] すべてのクラス属性に型ヒント
3. [ ] Optional型、Union型を適切に使用
4. [ ] コレクション型（List, Dict, Set）を適切に使用
5. [ ] 非同期関数の型ヒント
6. [ ] mypy でエラーがないことを確認

---

**作成日**: 2025-10-19
**対象フェーズ**: 実装
**重要度**: ⭐⭐⭐ 必須
