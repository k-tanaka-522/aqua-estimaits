# 2.5.3.4.1 testing基本パターン

## 目的

`.claude/docs/40_standards/44_go.md` に準拠したtestingテストコードを作成します。

---

## ✅ Go testing基本

### 命名規則

- テストファイル: `*_test.go`
- テスト関数: `func TestXxx(t *testing.T)`

### AAA (Arrange-Act-Assert) パターン

```go
package service

import (
    "testing"
)

func TestGetUser_WhenUserExists_ReturnsUser(t *testing.T) {
    // Arrange
    userID := 1
    expected := &User{ID: 1, Name: "Test User"}

    // Act
    result, err := GetUser(userID)

    // Assert
    if err != nil {
        t.Fatalf("unexpected error: %v", err)
    }
    if result.ID != expected.ID {
        t.Errorf("expected ID %d, got %d", expected.ID, result.ID)
    }
    if result.Name != expected.Name {
        t.Errorf("expected Name %s, got %s", expected.Name, result.Name)
    }
}
```

### テーブルドリブンテスト

```go
func TestValidateEmail(t *testing.T) {
    tests := []struct {
        name     string
        email    string
        expected bool
    }{
        {"valid email", "test@example.com", true},
        {"invalid format", "invalid@", false},
        {"empty string", "", false},
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            // Act
            result := ValidateEmail(tt.email)

            // Assert
            if result != tt.expected {
                t.Errorf("ValidateEmail(%s) = %v, want %v",
                    tt.email, result, tt.expected)
            }
        })
    }
}
```

### サブテスト

```go
func TestUserService(t *testing.T) {
    t.Run("GetUser", func(t *testing.T) {
        t.Run("success", func(t *testing.T) {
            // Arrange
            service := NewUserService()

            // Act
            result, err := service.GetUser(1)

            // Assert
            if err != nil {
                t.Fatalf("unexpected error: %v", err)
            }
            if result == nil {
                t.Error("expected user, got nil")
            }
        })

        t.Run("not found", func(t *testing.T) {
            // Arrange
            service := NewUserService()

            // Act
            result, err := service.GetUser(999)

            // Assert
            if err == nil {
                t.Error("expected error, got nil")
            }
            if result != nil {
                t.Error("expected nil, got user")
            }
        })
    })
}
```

### Helper関数

```go
func TestGetUser(t *testing.T) {
    t.Helper() // このテストがヘルパー関数であることを宣言

    tests := []struct {
        name   string
        userID int
        want   *User
        err    error
    }{
        {"success", 1, &User{ID: 1}, nil},
        {"not found", 999, nil, ErrNotFound},
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            got, err := GetUser(tt.userID)
            assertUser(t, got, tt.want, err, tt.err)
        })
    }
}

func assertUser(t *testing.T, got, want *User, gotErr, wantErr error) {
    t.Helper()

    if gotErr != wantErr {
        t.Errorf("error = %v, want %v", gotErr, wantErr)
    }
    if got != nil && want != nil && got.ID != want.ID {
        t.Errorf("ID = %d, want %d", got.ID, want.ID)
    }
}
```

---

**作成日**: 2025-10-19
**重要度**: ⭐⭐⭐
