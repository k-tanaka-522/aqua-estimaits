# 2.5.3.3.3 カバレッジ測定（coverlet）

## 目的

テストカバレッジを測定し、80%以上を達成します。

---

## 📊 カバレッジ測定

### coverletインストール

```bash
# coverlet.msbuildをインストール
dotnet add package coverlet.msbuild

# または coverlet.collectorをインストール
dotnet add package coverlet.collector
```

### 実行

```bash
# カバレッジ付きでテスト実行
dotnet test /p:CollectCoverage=true

# HTML形式でレポート生成
dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=opencover

# reportgeneratorでHTMLレポート作成
dotnet tool install -g dotnet-reportgenerator-globaltool
reportgenerator -reports:coverage.opencover.xml -targetdir:coverage-report
```

### カバレッジ設定（.csproj）

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <IsPackable>false</IsPackable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="coverlet.msbuild" Version="6.0.0">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
    </PackageReference>
  </ItemGroup>

  <PropertyGroup>
    <CollectCoverage>true</CollectCoverage>
    <CoverletOutputFormat>opencover</CoverletOutputFormat>
    <Threshold>80</Threshold>
    <ThresholdType>line,branch,method</ThresholdType>
    <Exclude>[MyApp.Tests]*,[*]*.Migrations.*</Exclude>
  </PropertyGroup>
</Project>
```

### coverlet.runsettings

```xml
<?xml version="1.0" encoding="utf-8" ?>
<RunSettings>
  <DataCollectionRunSettings>
    <DataCollectors>
      <DataCollector friendlyName="XPlat Code Coverage">
        <Configuration>
          <Format>opencover</Format>
          <Exclude>[MyApp.Tests]*,[*]*.Migrations.*</Exclude>
          <ExcludeByAttribute>Obsolete,GeneratedCode,CompilerGenerated</ExcludeByAttribute>
        </Configuration>
      </DataCollector>
    </DataCollectors>
  </DataCollectionRunSettings>
</RunSettings>
```

### CIでの実行

```bash
# カバレッジ閾値チェック付き
dotnet test /p:CollectCoverage=true /p:Threshold=80 /p:ThresholdType=line
```

### 目標

- ✅ **カバレッジ80%以上**
- ✅ 重要な業務ロジック: 90%以上
- ✅ Line、Branch、Methodすべてで達成

---

**作成日**: 2025-10-19
**重要度**: ⭐⭐⭐
