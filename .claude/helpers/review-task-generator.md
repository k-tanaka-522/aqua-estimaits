# レビュータスク自動生成ガイド

## 概要

コード・ドキュメント生成後、自動的にレビュータスクを生成し、ユーザーに確認を促すガイドラインです。

---

## 1. レビュータスク生成のタイミング

以下のタイミングで、自動的にレビュータスクを生成してください：

### 1.1 ドキュメント生成後
- 企画書
- 要件定義書
- 設計書（基本設計 / 詳細設計）
- テスト設計書

### 1.2 コード生成後
- CloudFormation / Terraform テンプレート
- アプリケーションコード（React / Node.js等）
- CI/CD設定（GitHub Actions）
- テストコード

### 1.3 設定ファイル生成後
- .eslintrc.json
- .prettierrc
- package.json
- Dockerfile

---

## 2. レビュータスクの構成

レビュータスクには以下を含めてください：

### 2.1 タスク基本情報
- タイトル
- 生成物の種類
- 対象ファイルのパス
- 生成日時

### 2.2 チェックリスト
- 生成物に応じた確認項目
- 各項目はチェックボックス形式

### 2.3 次のアクション
- 承認された場合の次の手順
- 非承認の場合の修正フロー

---

## 3. 生成物別のチェックリスト

### 3.1 企画書
```markdown
## レビュータスク: 企画書

生成ファイル: `docs/01_企画書.md`

### チェックリスト
- [ ] ビジネス背景が明確に記載されているか
- [ ] 解決したい課題が具体的に書かれているか
- [ ] 目標・KPIが測定可能か
- [ ] ターゲットユーザーが明確か
- [ ] 予算・スケジュールが現実的か
- [ ] ステークホルダーに説明できる内容か

### 次のアクション
- **承認**：要件定義フェーズに進みます
- **修正が必要**：修正したい箇所を教えてください
```

### 3.2 要件定義書
```markdown
## レビュータスク: 要件定義書

生成ファイル: `docs/02_要件定義書.md`

### チェックリスト
- [ ] 機能要件がすべて網羅されているか
- [ ] 非機能要件（性能、セキュリティ、可用性）が明確か
- [ ] 優先順位が適切に設定されているか
- [ ] 制約条件が明記されているか
- [ ] ユースケースが具体的に記載されているか
- [ ] 受入基準が明確か

### 次のアクション
- **承認**：設計フェーズに進みます
- **追加要件がある**：追加したい要件を教えてください
```

### 3.3 基本設計書
```markdown
## レビュータスク: 基本設計書

生成ファイル: `docs/03_基本設計書.md`

### チェックリスト
- [ ] アーキテクチャが要件を満たしているか
- [ ] 技術選定の根拠が明確か
- [ ] システム構成図が理解できるか
- [ ] 非機能要件への対応策が具体的か
- [ ] インフラ設計が適切か
- [ ] コスト見積もりが妥当か

### 次のアクション
- **承認**：詳細設計フェーズに進みます
- **設計変更が必要**：変更したい箇所を教えてください
```

### 3.4 詳細設計書
```markdown
## レビュータスク: 詳細設計書

生成ファイル: `docs/04_詳細設計書.md`

### チェックリスト
- [ ] データベーススキーマが正規化されているか
- [ ] API仕様が RESTful / 一貫性があるか
- [ ] ER図が正確か
- [ ] シーケンス図が理解できるか
- [ ] エラーハンドリング方針が明確か
- [ ] セキュリティ対策が具体的か

### 次のアクション
- **承認**：実装フェーズに進みます
- **修正が必要**：修正したい箇所を教えてください
```

### 3.5 CloudFormation / Terraform テンプレート
```markdown
## レビュータスク: CloudFormation テンプレート

生成ファイル:
- `infra/shared/stack.yaml`
- `infra/shared/nested/network.yaml`
- `infra/shared/deploy.sh`

### チェックリスト
- [ ] テンプレートの構造が理解できるか
- [ ] パラメータファイルの値が正しいか
- [ ] リソース命名規則に従っているか
- [ ] 環境差分（dev/stg/prod）が適切に管理されているか
- [ ] セキュリティグループの設定が適切か
- [ ] デプロイスクリプトの内容が理解できるか

### デプロイ前の確認
- [ ] **Dry-run実行**: `./deploy.sh dev --dry-run` で差分確認
- [ ] 変更内容に問題がないか

### 次のアクション
- **承認**：デプロイを実行します
- **修正が必要**：修正したい箇所を教えてください
```

### 3.6 アプリケーションコード（React / Node.js）
```markdown
## レビュータスク: アプリケーションコード

生成ファイル: `src/`

### チェックリスト
- [ ] ディレクトリ構造が規約に従っているか
- [ ] 命名規則が統一されているか
- [ ] コメントが適切に記載されているか
- [ ] エラーハンドリングが実装されているか
- [ ] 型定義（TypeScript）が適切か
- [ ] セキュリティ対策（バリデーション、エスケープ）がされているか

### コード品質チェック
- [ ] **Lint実行**: `npm run lint` でエラーがないか
- [ ] **型チェック**: `npm run type-check` でエラーがないか

### 次のアクション
- **承認**：テストフェーズに進みます
- **修正が必要**：修正したい箇所を教えてください
```

### 3.7 CI/CD設定（GitHub Actions）
```markdown
## レビュータスク: CI/CD設定

生成ファイル: `.github/workflows/deploy.yml`

### チェックリスト
- [ ] トリガー設定が適切か（ブランチ、イベント）
- [ ] ジョブの順序が正しいか（ビルド → テスト → デプロイ）
- [ ] 環境変数・シークレットが適切に設定されているか
- [ ] デプロイ承認フローが必要な環境に設定されているか
- [ ] 通知設定（成功/失敗）が適切か

### 次のアクション
- **承認**：GitHub Actionsを有効化します
- **修正が必要**：修正したい箇所を教えてください
```

### 3.8 テストコード
```markdown
## レビュータスク: テストコード

生成ファイル: `src/**/*.test.ts`

### チェックリスト
- [ ] 正常系・異常系の両方がテストされているか
- [ ] 境界値がテストされているか
- [ ] テストカバレッジが目標値（80%）を満たしているか
- [ ] モック・スタブが適切に使用されているか
- [ ] テストケース名が分かりやすいか

### テスト実行
- [ ] **テスト実行**: `npm test` ですべて成功するか
- [ ] **カバレッジ確認**: `npm run test:coverage` で確認

### 次のアクション
- **承認**：デプロイフェーズに進みます
- **テスト追加が必要**：追加したいテストケースを教えてください
```

---

## 4. Claude の動作フロー

### 4.1 ドキュメント生成後
```
1. ドキュメントを生成（例：企画書）
2. `docs/01_企画書.md`を保存
3. レビュータスクを自動生成
4. `.claude-state/tasks.json`に追加
5. ユーザーに以下を提示：

「企画書を作成しました。内容を確認してください。

## レビュータスク: 企画書

生成ファイル: `docs/01_企画書.md`

### チェックリスト
- [ ] ビジネス背景が明確に記載されているか
- [ ] 解決したい課題が具体的に書かれているか
...

承認いただけますか？（承認 / 修正が必要）」
```

### 4.2 コード生成後（CloudFormation の場合）
```
1. CloudFormationテンプレート生成
2. `infra/shared/`配下に保存
3. レビュータスクを自動生成
4. `.claude-state/tasks.json`に追加
5. ユーザーに以下を提示：

「CloudFormationテンプレートを作成しました。

## レビュータスク: CloudFormation テンプレート

生成ファイル:
- `infra/shared/stack.yaml`
- `infra/shared/nested/network.yaml`

### チェックリスト
- [ ] テンプレートの構造が理解できるか
- [ ] パラメータファイルの値が正しいか
...

### デプロイ前の確認
まず、dry-runで差分を確認しますか？」
```

---

## 5. tasks.json への記録

レビュータスクは`.claude-state/tasks.json`に以下の形式で記録してください：

```json
{
  "tasks": [
    {
      "id": "review-task-001",
      "type": "review",
      "title": "企画書のレビュー",
      "status": "pending",
      "priority": "high",
      "created_at": "2025-10-03T10:00:00Z",
      "completed_at": null,
      "phase": "planning",
      "target": {
        "type": "document",
        "files": ["docs/01_企画書.md"]
      },
      "checklist": [
        "ビジネス背景が明確に記載されているか",
        "解決したい課題が具体的に書かれているか",
        "目標・KPIが測定可能か",
        "ターゲットユーザーが明確か",
        "予算・スケジュールが現実的か"
      ],
      "result": null,
      "feedback": null
    }
  ]
}
```

---

## 6. ユーザーの承認処理

### 6.1 承認された場合
```
ユーザー: 承認します
Claude:
1. `.claude-state/tasks.json`の該当タスクを更新
   - status: "completed"
   - result: "approved"
   - completed_at: 現在時刻
2. 次のフェーズに進む
3. 「承認ありがとうございます。次のフェーズ（要件定義）に進みます」
```

### 6.2 修正が必要な場合
```
ユーザー: ビジネス背景の部分を修正してください
Claude:
1. `.claude-state/tasks.json`の該当タスクを更新
   - status: "in_progress"
   - feedback: "ビジネス背景の修正"
2. 修正を実施
3. 修正後、再度レビュータスクを提示
```

---

## 7. まとめ

**レビュータスクの目的：**
- ユーザーが生成物を見落とさない
- 確認観点を明確にする
- 承認/非承認の記録を残す
- プロジェクトの透明性を確保

**Claude の責務：**
- 生成後、必ずレビュータスクを作成
- チェックリストを具体的に提示
- tasks.jsonに記録
- ユーザーの承認を待つ
