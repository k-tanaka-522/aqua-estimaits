# Implementation Checker

## 目的

**実装フェーズで設計書を強制的に参照させる**仕組みです。

設計書に「実装方針」が書かれていても、実装者（AI含む）が読まなければ意味がありません。
このヘルパーは、実装開始前に設計書の実装方針を確認し、不足があれば警告を出します。

---

## 🎯 実装フェーズ開始時の必須チェック

実装フェーズに入る際、**必ず以下を確認してください**：

### 1. 設計書の存在確認

```bash
# 基本設計書と詳細設計書が存在するか
docs/03_基本設計書.md
docs/04_詳細設計書.md
```

**存在しない場合**:
→ 設計フェーズが完了していません。先に設計フェーズを完了させてください。

### 2. 実装方針セクションの存在確認

詳細設計書を読み込み、以下のセクションが存在するか確認：

```markdown
## 10. 実装方針
### 10.1 ファイル分割方針
### 10.2 ディレクトリ構成
### 10.3 モジュール分割
### 10.4 命名規則
### 10.5 技術標準の適用
### 10.6 推定行数と分割理由
```

**存在しない場合**:
→ ❌ **実装フェーズに進めません**
→ ユーザーに以下を提案：

```
設計書に「実装方針」セクションが見つかりませんでした。

実装方針がないと、以下の問題が発生します：
- ファイル分割が不明確になり、巨大なファイルが生成される
- 技術標準が守られない
- メンテナンス性の低いコードが生成される

【推奨アクション】
1. 設計フェーズに戻る
2. 詳細設計書に「実装方針」セクションを追加
3. `.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.7_実装方針設計.md` を参照

このまま進めますか？（推奨しません）
```

### 3. 実装方針の内容確認

実装方針セクションが存在する場合、以下を確認：

#### 3.1 ファイル分割方針が具体的か？

**Good**:
```markdown
### 10.1 ファイル分割方針

```
infra/cloudformation/
├── network.yaml    # VPC, Subnet (推定245行)
├── database.yaml   # RDS (推定352行)
└── compute.yaml    # 親スタック (推定180行)
    └── nested/
        ├── ecs.yaml    # ECS (推定280行)
        └── alb.yaml    # ALB (推定220行)
```
```

**Bad**:
```markdown
### 10.1 ファイル分割方針

適切に分割する。
```

**Bad の場合**:
→ ⚠️ **警告**: ファイル分割方針が抽象的です。具体的なファイル構成と推定行数を記載してください。

#### 3.2 推定行数が記載されているか？

各ファイルの推定行数が明記されているか確認。

**記載なしの場合**:
→ ⚠️ **警告**: 推定行数がありません。300行超える場合の分割理由が不明です。

#### 3.3 技術標準への参照があるか？

```markdown
### 10.5 技術標準の適用

**参照**: `.claude/docs/40_standards/45_cloudformation.md`
```

**参照なしの場合**:
→ ⚠️ **警告**: 技術標準への参照がありません。どの規約に従うか不明です。

---

## 🔧 Claude の実装時の動作

### 実装フェーズ開始時（自動実行）

```
1. `.claude-state/project-state.json` を読み込み
2. currentPhase が "implementation" の場合、以下を実行：

   a. `docs/04_詳細設計書.md` を読み込み
   b. 「## 10. 実装方針」セクションを検索
   c. セクションが存在しない場合 → ❌ エラーメッセージ
   d. セクションが存在する場合 → 内容を確認
      - ファイル分割方針が具体的か？
      - 推定行数が記載されているか？
      - 技術標準への参照があるか？
   e. 問題がある場合 → ⚠️ 警告メッセージ
   f. 問題がない場合 → ✅ 実装開始
```

### 実装中（各ファイル作成時）

```
新しいファイルを作成する前に：

1. 設計書の「10.1 ファイル分割方針」を確認
2. 作成しようとしているファイルが設計書に記載されているか確認
3. 推定行数と実際の行数を比較
4. 300行を超える場合:
   a. 設計書に理由が記載されているか確認
   b. 記載なし → ⚠️ 警告: 「設計書に300行超える理由がありません」
   c. 記載あり → ✅ OK
```

---

## 📝 実装チェックリスト

実装フェーズ開始前に、以下を確認してください：

### Phase 1: 設計書の確認

- [ ] `docs/03_基本設計書.md` が存在する
- [ ] `docs/04_詳細設計書.md` が存在する
- [ ] 詳細設計書に「## 10. 実装方針」セクションがある

### Phase 2: 実装方針の内容確認

- [ ] 10.1 ファイル分割方針が具体的（ディレクトリ構成図あり）
- [ ] 10.2 ディレクトリ構成が明記されている
- [ ] 10.3 モジュール分割が明記されている
- [ ] 10.4 命名規則が明記されている
- [ ] 10.5 技術標準への参照がある
- [ ] 10.6 推定行数と分割理由が記載されている

### Phase 3: 技術標準の確認

- [ ] 参照すべき技術標準ファイルが明記されている
- [ ] プロジェクト固有の例外事項が記載されている（あれば）

### Phase 4: 実装開始

- [ ] 上記すべてをクリア
- [ ] ファイル作成前に設計書を再確認
- [ ] 作成後に `/check` コマンドで検証

---

## ⚠️ 警告メッセージ一覧

### エラー（実装を停止）

```
❌ エラー: 詳細設計書に「実装方針」セクションがありません

実装方針がないと、技術標準が守られず、メンテナンス性の低いコードが生成されます。

【推奨アクション】
1. 設計フェーズに戻る
2. `.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.7_実装方針設計.md` を参照
3. 詳細設計書に「実装方針」セクションを追加

このまま進めますか？（推奨しません）
[Y/n]
```

### 警告（続行可能だが推奨しない）

```
⚠️ 警告: ファイル分割方針が抽象的です

現在の記載: "適切に分割する"

【推奨】
具体的なディレクトリ構成と推定行数を記載してください。

例:
```
infra/cloudformation/
├── network.yaml    # VPC, Subnet (推定245行)
└── database.yaml   # RDS (推定352行)
```

続行しますか？
[y/N]
```

```
⚠️ 警告: 推定行数が記載されていません

各ファイルの推定行数を記載してください。
これにより、300行を超える場合の分割判断が明確になります。

続行しますか？
[y/N]
```

```
⚠️ 警告: 技術標準への参照がありません

どの技術標準に従うか不明です。

【推奨】
`.claude/docs/40_standards/` から適用する規約を選択し、
実装方針セクションに記載してください。

続行しますか？
[y/N]
```

---

## 🔄 設計書へのフィードバック

実装中に設計書の不備が見つかった場合：

1. **実装を一時停止**
2. **設計フェーズに戻る**
3. **設計書を更新**
4. **実装を再開**

### 例: ファイル分割が不足していた場合

```
実装中に判明した問題:
- compute.yaml が800行を超える見込み
- 設計書には分割方針の記載なし

【対応】
1. 設計フェーズに戻る
2. 詳細設計書の「10.1 ファイル分割方針」を更新:
   - compute.yaml をネスト構成に分割
   - nested/ecs.yaml (280行)
   - nested/alb.yaml (220行)
3. 実装を再開
```

---

## 🎯 まとめ

### 実装チェッカーの3原則

1. **設計書を読む**
   - 実装方針セクションが必須

2. **具体性を確認する**
   - 抽象的な記述は警告

3. **技術標準を参照する**
   - 参照リンクが必須

### Claude の役割

- 実装フェーズ開始時に自動チェック
- 問題がある場合は警告またはエラー
- ユーザーに設計書更新を提案
- 実装中も設計書との整合性を確認

---

**作成日**: 2025-10-21
**対象フェーズ**: 実装（事前チェック）
**重要度**: ⭐⭐⭐ 必須
**関連ドキュメント**:
- `.claude/docs/10_facilitation/2.3_設計フェーズ/2.3.7_実装方針設計.md` - 実装方針の書き方
- `.claude/docs/10_facilitation/2.4_実装フェーズ/` - 実装フェーズプロセス
- `.claude/commands/check.md` - 生成物チェックコマンド
